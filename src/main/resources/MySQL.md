## MySql

### 索引

索引是在存储引擎层实现的，所以不同存储引擎具有不同的所以类型和实现。

索引是帮助MySQL高效获取数据的数据结构

### 磁盘相关知识

1. 系统从磁盘读取数据到内存时，是以“磁盘块”为基本单位的，位于同一磁盘块中的数据会被一次性读取出来，而不是需要什么取什么

2. InnoDB存储引擎中，有“页”的概念，页是磁盘管理的最小单位。InnoDB存储引擎中默认每个页的大小为16kb，可通过参数innodb_page_size将页大小设置为4k、8、16k

   ~~~mysql
   #查看 页 大小命令
   mysql> show variables like 'innodb_page_size'
   ~~~

3. 然而系统一个磁盘块的存储空间往往没有这么大，因此InnoDB每次申请磁盘空间时都会是若干地址连续磁盘块来达到页的大小16KB。InnoDB在把磁盘数据读入到磁盘时会以页为基本单位，在查询数据时如果一个页中的每条数据都能有助于定位数据记录的位置，这将会减少磁盘I/O次数，提高查询效率

### B树

1. 一种用于查找的平衡树，但是不是二叉树，就是平衡多路查找树
2. 能够用来存储排序后的数据

#### 性质

1. B树的阶：子节点数目的最大值
2. 每个节点中，包含数据的关键字key、数据Data、指向子节点的指针
3. 

---

### B+树

1. B树上做的优化
2. InnoDB存储引擎用B+树，实现的索引
3. 所有数据记录在叶子节点上，其数值是按照大小顺序存放在同一层的叶子节点上，非叶子节点只存放key值信息，这样大大加大每个节点存储key的数量，降低了B+tree 的高度
4. 所有叶子节点之间有一个链指针

#### MySQL索引

###### 索引分类

1. 照数据的存储方式分类
   - 聚集索引
     - 存放的物理顺序和列中的顺序一样，一般设置主键索引就为聚集索引
     - 一个表只能有一个聚集索引，因为主键的作用就是把表的数据格式转换为索引的格式存放
     - 例如select * from xx where id="12":根据索引定位到12所在的叶节点，然后通过叶节点获取id=12的数据行
   - 非聚集索引
     - 例如：User表中的name字段加上索引
     - 和聚集索引一样，同样是采用平衡多路查找树作为索引的数据结构，索引树结构中各节点的值来自表中的索引字段。例如：User表中的name字段加上索引。那么索引就是由name字段中的值构成的
     - 通过非聚集索引第一次只能查到记录对应的主键，然后再通过主键的值进行聚集索引找到需要的数据
     - 每次给字段建一个新索引，字段中的数据就会被复制一份出来，用于生成索引。每个索引互相不存在关联**
   - 两个索引的区别：聚集索引一张表只能有一个，然而非聚集索引一张表 可以有多个
2. 应用层次
   - 单列索引
     - 主键索引
     - 普通索引
     - 唯一索引
       - 和普通索引基本类似，不过唯一索引所在列的值必须唯一，可以为null值。
   - 组合索引
     - 多个字段上创建的索引
     - 使用组合索引时，遵循最左前缀集合
     - 例如：index (a,b,c) 那么 索引支持a | a、b | abc 这三种组合进行查找，但是不支持b | c | b、c 这样的查找，必须按照索引字段创建的顺序来
   - 全文索引  fulltext
     - 通过关键字的匹配来进行查询过滤=》基于相似度的查询
3. 存储结构
   - B树索引
   - B+树索引
   - Hash索引
   - 等

索引定位数据：查询到B+树叶子节点后，遍历叶子节点的数据页，从而找出该条记录



### InnoDB的索引类型

#### B+树索引

1. InnoDB的B+树索引分为：主索引（聚簇索引）和辅助索引（非聚簇索引）

2. 主索引：

   - 以主键作为B+树索引的键值所构成的B+树索引，叶子节点data域记录着完整的数据记录，这种索引方式被称为**聚簇索引**，因为无法把数据行存放在两个不同的地方（InnoDB的数据文件本身就是索引文件），所以一个表只有一个聚簇索引。图中：数字代表主键值

   - ![img](https://pdai-1257820000.cos.ap-beijing.myqcloud.com/pdai.tech/public/_images/mysql/c28c6fbc-2bc1-47d9-9b2e-cf3d4034f877.jpg)

     

3. 辅助索引：叶子节点data域记录着主键的值，因此使用辅助索引进行查找时，需要先查到主键值，然后再到主索引中进行查找。单词代表非主键的列值

   - ![img](https://pdai-1257820000.cos.ap-beijing.myqcloud.com/pdai.tech/public/_images/mysql/7ab8ca28-2a41-4adf-9502-cc0a21e63b51.jpg)

#### Hash索引

Hash索引基于Hash表实现，对于每一行数据，存储引擎会对索引列通过hash算法进行hash计算得到hash码，并且哈希算法要尽量保证不同的列值计算出的哈希码值是不同的，将哈希码值作为哈希表的key，将指向数据行的指针作为哈希表的value值。这样查找一个数据的时间复杂度就是O(1)，一般用于精确查找

#### 区别

1. 因为两者数据结构上的差异导致它们的使用场景也不同，哈希索引一般多用于精确的等值查找，B+索引则多用于除了精确的等值查找外的其他查找。在大多数情况下，会选择使用B+树索引



### 